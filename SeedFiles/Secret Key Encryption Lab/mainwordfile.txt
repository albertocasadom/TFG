SEEDLabsŒSecret-KeyEncryptionLab 1 Secret-KeyEncryptionLab Copyright©2018WenliangDu SyracuseUniversity ThedevelopmentofthisdocumentwaspartiallyfundedbytheNationalScienceFoundationunderAward No.1303306and1718086.ThisworkislicensedunderaCreativeCommonsAttribution-NonCommercial- ShareAlike4.0InternationalLicense.Ahuman-readablesummaryof andnotasubstitutefor thelicenseis thefollowing Youarefreetocopyandredistributethematerialinanymediumorformat.Youmustgive appropriatecredit.Ifyouremix transform orbuilduponthematerial youmustdistributeyourcontributions underthesamelicenseastheoriginal.Youmaynotusethematerialforcommercialpurposes 1Overview Thelearningobjectiveofthislabisforstudentstogetfamiliarwiththeconceptsinthesecret-keyencryption Afterthelab studentsshouldbeabletogainaexperienceonencryptionalgorithms encryptionmodes paddings andinitialvector IV .Moreover studentswillbeabletousetoolsandwrite programstoencrypt/decryptmessages.Thislabcoversthefollowingtopics Ł Secret-keyencryption Ł Substitutioncipherandfrequencyanalysis Ł Encryptionmodesandpaddings Ł Programmingusingthecryptolibrary LabEnvironment Thislabhasbeentestedonourpre-builtUbuntu12.04VMandUbuntu16.04VM bothofwhichcanbedownloadedfromtheSEEDwebsite 2LabTasks 2.1Task1 FrequencyAnalysisAgainstMonoalphabeticSubstitutionCipher Itiswell-knownthatmonoalphabeticsubstitutioncipher alsoknownasmonoalphabeticcipher isnot secure becauseitcanbesubjectedtofrequencyanalysis.Inthislab youaregivenacipher-textthatis encryptedusingamonoalphabeticcipher namely eachletterintheoriginaltextisreplacedbyanother letter wherethereplacementdoesnotvary i.e. aletterisalwaysreplacedbythesameletterduringthe encryption .Yourjobistoouttheoriginaltextusingfrequencyanalysis.Itisknownthattheoriginal textisanEnglisharticle Inthefollowing wedescribehowweencrypttheoriginalarticle andwhatwehavemade Instructorscanusethesamemethodtoencryptanarticleoftheirchoices insteadofaskingstudentstouse theciphertextmadebyus Ł Step1 letusdosometotheoriginalarticle.Weconvertalluppercasestolowercases andthenremovedallthepunctuationsandnumbers.Wedokeepthespacesbetweenwords soyoucan stillseetheboundariesofthewordsintheciphertext.Inrealencryptionusingmonoalphabeticcipher spaceswillberemoved.Wekeepthespacestosimplifythetask.Wedidthisusingthefollowing command $ tr upper lower < article.txt > lowercase.txt $ tr-cd ' a-z \n space ' < lowercase.txt > plaintext.txt SEEDLabsŒSecret-KeyEncryptionLab 2 Ł Step2 letusgeneratetheencryptionkey i.e. thesubstitutiontable.Wewillpermutethealphabet z usingPython andusethepermutedalphabetasthekey.Seethefollowingprogram $ python > > > importrandom > > > s= '' abcdefghijklmnopqrstuvwxyz '' > > > list=random.sample len > > > ''.join list 'sxtrwinqbedpvgkfmalhyuojzc' Ł Step3 weusethe tr commandtodotheencryption.Weonlyencryptletters whileleavingthespace andreturncharactersalone $ tr'abcdefghijklmnopqrstuvwxyz '' sxtrwinqbedpvgkfmalhyuojzc'\ < plaintext.txt > ciphertext.txt Wehavecreatedaciphertextusingadifferentencryptionkey nottheonedescribedabove .Youcan downloaditfromthelab'swebsite.Yourjobistousethefrequencyanalysistoouttheencryption keyandtheoriginalplaintext Guidelines Usingthefrequencyanalysis youcanouttheplaintextforsomeofthecharactersquite easily.Forthosecharacters youmaywanttochangethembacktoitsplaintext asyoumaybeabletoget moreclues.Itisbettertousecapitallettersforplaintext soforthesameletter weknowwhichisplaintext andwhichisciphertext.Youcanusethe tr commandtodothis.Forexample inthefollowing wereplace letters e in.txt withletters X G E respectively theresultsaresavedin out.txt $ tr'aet '' XGE ' < in.txt > out.txt Therearemanyonlineresourcesthatyoucanuse.Welistfourusefullinksinthefollowing Ł http //www.richkni.co.uk/php/crypta/freq.php Thiswebsitecanproducethestatis- ticsfroaciphertext includingthesingle-letterfrequencies bigramfrequencies 2-lettersequence andtrigramfrequencies 3-lettersequence etc Ł https //en.wikipedia.org/wiki/Frequency_analysis ThisWikipediapagepro- videsfrequenciesforatypicalEnglishplaintext Ł https //en.wikipedia.org/wiki/Bigram Bigramfrequency Ł https //en.wikipedia.org/wiki/Trigram Trigramfrequency 2.2Task2 EncryptionusingDifferentCiphersandModes Inthistask wewillplaywithvariousencryptionalgorithmsandmodes.Youcanusethefollowing opensslenc commandtoencrypt/decryptaToseethemanuals youcantype manopenssl manenc $ opensslenc-ciphertype-e-inplain.txt-outcipher.bin\ -K00112233445566778889aabbccddeeff\ -iv0102030405060708 SEEDLabsŒSecret-KeyEncryptionLab 3 Pleasereplacethe ciphertype withaciphertype suchas -aes-128-cbc -bf-cbc -aes-128-cfb etc.Inthistask youshouldtryatleast3differentciphers.Youcanthemeaning ofthecommand-lineoptionsandallthesupportedciphertypesbytyping '' manenc '' .Weincludesome commonoptionsforthe opensslenc commandinthefollowing -in < file > inputfile -out < file > outputfile -eencrypt -ddecrypt -K/-ivkey/ivinhexisthenextargument - pP printtheiv/key thenexitif-P 2.3Task3 EncryptionModeŒECBvs.CBC The pic original.bmp canbedownloadedfromthislab'swebsite anditcontainsasimplepicture Wewouldliketoencryptthispicture sopeoplewithouttheencryptionkeyscannotknowwhatisinthe picture.PleaseencrypttheusingtheECB ElectronicCodeBook andCBC CipherBlockChaining modes andthendothefollowing 1 Letustreattheencryptedpictureasapicture anduseapictureviewingsoftwaretodisplayit.How- ever Forthe .bmp the54bytescontaintheheaderinformationaboutthepicture wehave tosetitcorrectly sotheencryptedcanbetreatedasalegitimate .bmp Wewillreplacethe headeroftheencryptedpicturewiththatoftheoriginalpicture.Wecanusethe bless hexeditor tool alreadyinstalledonourVM todirectlymodifybinaryWecanalsousethefollowing commandstogettheheaderfrom p1.bmp thedatafrom p2.bmp fromoffset55totheendofthe andthencombinetheheaderanddatatogetherintoanew $ head-c54p1.bmp > header $ tail-c+55p2.bmp > body $ catheaderbody > new.bmp 2 Displaytheencryptedpictureusingapictureviewingprogram wehaveinstalledanimageviewer programcalled eog onourVM .Canyouderiveanyusefulinformationabouttheoriginalpicture fromtheencryptedpicture ? Pleaseexplainyourobservations Selectapictureofyourchoice repeattheexperimentabove andreportyourobservations 2.4Task4 Padding Forblockciphers whenthesizeofaplaintextisnotamultipleoftheblocksize paddingmayberequired AlltheblockciphersnormallyusePKCS # 5padding whichisknownasstandardblockpadding.Wewill conductthefollowingexperimentstounderstandhowthistypeofpaddingworks 1 UseECB CBC CFB andOFBmodestoencrypta youcanpickanycipher .Pleasereportwhich modeshavepaddingsandwhichonesdonot.Forthosethatdonotneedpaddings pleaseexplainwhy 2 Letuscreatethreewhichcontain5bytes,10bytes and16bytes respectively.Wecanusethe following '' echo-n '' commandtocreatesuchThefollowingexamplecreatesa f1.txt withlength5 withoutthe -n option thelengthwillbe6 becauseanewlinecharacterwillbeadded echo SEEDLabsŒSecret-KeyEncryptionLab 4 $ echo-n '' 12345 '' > f1.txt Wethenuse '' opensslenc-aes-128-cbc-e '' toencryptthesethreeusing128-bitAES withCBCmode.Pleasedescribethesizeoftheencrypted Wewouldliketoseewhatisaddedtothepaddingduringtheencryption.Toachievethisgoal willdecrypttheseusing '' opensslenc-aes-128-cbc-d '' .Unfortunately decryption bydefaultwillautomaticallyremovethepadding makingitimpossibleforustoseethepadding However thecommanddoeshaveanoptioncalled '' -nopad '' whichdisablesthepadding i.e. duringthedecryption thecommandwillnotremovethepaddeddata.Therefore bylookingatthe decrypteddata wecanseewhatdataareusedinthepadding.Pleaseusethistechniquetoout whatpaddingsareaddedtothethree Itshouldbenotedthatpaddingdatamaynotbeprintable soyouneedtouseahextooltodisplaythe content.Thefollowingexampleshowshowtodisplayainthehexformat $ hexdump-Cp1.txt 00000000313233343536373839494a4b4c0a|123456789IJKL.| $ xxdp1.txt 00000000:313233343536373839494a4b4c0a123456789IJKL 2.5Task5 ErrorPropagationŒCorruptedCipherText Tounderstandtheerrorpropagationpropertyofvariousencryptionmodes wewouldliketodothefollowing exercise 1 Createatextthatisatleast1000byteslong 2 EncrypttheusingtheAES-128cipher 3 Unfortunately asinglebitofthe55thbyteintheencryptedgotcorrupted.Youcanachievethis corruptionusingthe bless hexeditor 4 DecryptthecorruptedciphertextusingthecorrectkeyandIV Pleaseanswerthefollowingquestion Howmuchinformationcanyourecoverbydecryptingthecor- ruptediftheencryptionmodeisECB CBC CFB orOFB respectively ? Pleaseanswerthisquestion beforeyouconductthistask andthenoutwhetheryouransweriscorrectorwrongafteryouthis task.Pleaseprovide 2.6Task6 InitialVector IV Mostoftheencryptionmodesrequireaninitialvector IV .PropertiesofanIVdependonthecryptographic schemeused.IfwearenotcarefulinselectingIVs thedataencryptedbyusmaynotbesecureatall even thoughweareusingasecureencryptionalgorithmandmode.Theobjectiveofthistaskistohelpstudents understandtheproblemsifanIVisnotselectedproperly.Pleasedothefollowingexperiments Ł Task6.1 AbasicrequirementforIVis uniqueness whichmeansthatnoIVmaybereusedunderthe samekey.Tounderstandwhy pleaseencryptthesameplaintextusing 1 twodifferentIVs 2 thesameIV.Pleasedescribeyourobservation basedonwhich explainwhyIVneedstobeunique SEEDLabsŒSecret-KeyEncryptionLab 5 Ł Task6.2 Onemayarguethatiftheplaintextdoesnotrepeat usingthesameIVissafe.Letuslook attheOutputFeedback OFB mode.Assumethattheattackergetsholdofaplaintext P1 anda ciphertext C1 canhe/shedecryptotherencryptedmessagesiftheIVisalwaysthesame ? Youare giventhefollowinginformation pleasetrytoouttheactualcontentof P2 basedon C2 P1 C1 Plaintext P1 Thisisaknownmessage ! Ciphertext C1 a469b1c502c1cab966965e50425438e1bb1b5f9037a4c159 Plaintext P2 unknowntoyou Ciphertext C2 bf73bcd3509299d566c35b5d450337e1bb175f903fafc159 IfwereplaceOFBinthisexperimentwithCFB CipherFeedback howmuchof P2 canberevealed ? Youonlyneedtoanswerthequestion thereisnoneedtodemonstratethat Theattackusedinthisexperimentiscalledthe known-plaintextattack whichisanattackmodelfor cryptanalysiswheretheattackerhasaccesstoboththeplaintextanditsencryptedversion ciphertext Ifthiscanleadtotherevealingoffurthersecretinformation theencryptionschemeisnotconsidered assecure Ł Task6.3 Fromtheprevioustasks wenowknowthatIVscannotrepeat.Anotherimportantrequire- mentonIVisthatIVsneedtobeunpredictableformanyschemes i.e. IVsneedtoberandomly generated.Inthistask wewillseewhatisgoingtohappenifIVsarepredictable AssumethatBobjustsentoutanencryptedmessage andEveknowsthatitscontentiseither Yes No EvecanseetheciphertextandtheIVusedtoencryptthemessage butsincetheencryption algorithmAESisquitestrong Evehasnoideawhattheactualcontentis.However sinceBobuses predictableIVs EveknowsexactlywhatIVBobisgoingtousenext.Thefollowingsummarizes whatBobandEveknow Encryptionmethod:128-bitAESwithCBCmode Key inhex :00112233445566778899aabbccddeeff knownonlytoBob Ciphertext C1 bef65565572ccee2a9f9553154ed9498 knowntoboth IVusedonP1 knowntoboth inascii :1234567890123456 inhex :31323334353637383930313233343536 NextIV knowntoboth inascii :1234567890123457 inhex :31323334353637383930313233343537 Agoodciphershouldnotonlytoleratetheknown-plaintextattackdescribedpreviously itshouldalso toleratethe chosen-plaintextattack whichisanattackmodelforcryptanalysiswheretheattacker canobtaintheciphertextforanarbitraryplaintext.SinceAESisastrongcipherthatcantolerate thechosen-plaintextattack BobdoesnotmindencryptinganyplaintextgivenbyEve hedoesusea differentIVforeachplaintext butunfortunately theIVshegeneratesarenotrandom andtheycan alwaysbepredictable Yourjobistoconstructamessage P2 andaskBobtoencryptitandgiveyoutheciphertext.Your objectiveistousethisopportunitytooutwhethertheactualcontentof P1 Yes No .Youcan readthisWikipediapageforideas https //en.wikipedia.org/wiki/Initialization_ vector SEEDLabsŒSecret-KeyEncryptionLab 6 TherearemoreadvancedcryptanalysisonIVthatisbeyondthescopeofthislab.Studentscanreadthe articlepostedinthisURL https //defuse.ca/cbcmodeiv.htm .BecausetherequirementsonIV reallydependoncryptographicschemes itishardtorememberwhatpropertiesshouldbemaintainedwhen weselectanIV.However wewillbesafeifwealwaysuseanewIVforeachencryption andthenewIV needstobegeneratedusingagoodpseudorandomnumbergenerator soitisunpredictablebyadversaries SeeanotherSEEDlabs RandomNumberGenerationLab fordetailsonhowtogeneratecryptographically strongpseudorandomnumbers 2.7Task7 ProgrammingusingtheCryptoLibrary ThistaskismainlydesignedforstudentsinComputerScience/Engineeringorrelatedwherepro- grammingisrequired.Studentsshouldcheckwiththeirprofessorstoseewhetherthistaskisrequiredfor theircoursesornot Inthistask youaregivenaplaintextandaciphertext andyourjobistothekeythatisusedforthe encryption.Youdoknowthefollowingfacts Ł The aes-128-cbc cipherisusedfortheencryption Ł ThekeyusedtoencryptthisplaintextisanEnglishwordshorterthan16characters thewordcanbe foundfromatypicalEnglishdictionary.Sincethewordhaslessthan16characters i.e.128bits poundsigns # hexadecimalvalueis 0x23 areappendedtotheendofthewordtoformakeyof 128bits Yourgoalistowriteaprogramtoouttheencryptionkey.YoucandownloadaEnglishwordlist fromtheInternet.Wehavealsolinkedoneonthewebpageofthislab.Theplaintext ciphertext andIVare listedinthefollowing Plaintext total21characters Thisisatopsecret Ciphertext inhexformat :764aa26b55a4da654df6b19e4bce00f4 ed05e09346fb0e762583cb7da2ac93a2 IV inhexformat aabbccddeeff00998877665544332211 Youneedtopayattentiontothefollowingissues Ł Ifyouchoosetostoretheplaintextmessageinaandfeedthetoyourprogram youneedto checkwhetherthelengthis21.Ifyoutypethemessageinatexteditor youneedtobeawarethat someeditorsmayaddaspecialcharactertotheendoftheTheeasiestwaytostorethemessage inaistousethefollowingcommand -n tells echo nottoaddatrailingnewline $ echo-n '' Thisisatopsecret `` > file Ł Inthistask youaresupposedtowriteyourownprogramtoinvokethecryptolibrary.Nocreditwill begivenifyousimplyusethe openssl commandstodothistask.Samplecodecanbefoundfrom thefollowingURL https //www.openssl.org/docs/man1.0.2/crypto/EVP_EncryptInit.html Ł Whenyoucompileyourcodeusing gcc donotforgettoincludethe -lcrypto becauseyour codeneedsthe crypto library.Seethefollowingexample $ gcc-omyencmyenc.c-lcrypto SEEDLabsŒSecret-KeyEncryptionLab 7 Notetoinstructors Weencourageinstructorstogeneratetheirownplaintextandciphertextusingadif- ferentkey thiswaystudentswillnotbeabletogettheanswerfromanotherplaceorfrompreviouscourses Instructorscanusethefollowingcommandstoachievethisgoal pleasereplacetheword example anothersecretword andaddthecorrectnumberof # signstomakethelengthofthestringtobe16 $ echo-n '' Thisisatopsecret `` > plaintext.txt $ echo-n '' example # # # # # # # # # '' > key $ xxd-pkey 6578616d706c65232323232323232323 $ opensslenc-aes-128-cbc-e-inplaintext.txt-outciphertext.bin\ -K6578616d706c65232323232323232323\ -iv010203040506070809000a0b0c0d0e0f\ $ xxd-pciphertext.bin e5accdb667e8e569b1b34f423508c15422631198454e104ceb658f5918800c22 3Submission Youneedtosubmitadetailedlabreport withscreenshots todescribewhatyouhavedoneandwhatyou haveobserved.Youalsoneedtoprovideexplanationtotheobservationsthatareinterestingorsurprising Pleasealsolisttheimportantcodesnippetsfollowedbyexplanation.Simplyattachingcodewithoutany explanationwillnotreceivecredits 