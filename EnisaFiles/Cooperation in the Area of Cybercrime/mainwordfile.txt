European Union Agency Network Information Security www.enisa.europa.eu Identifying handling cybercrime traces Toolset Document students September 2013 Identifying handling cybercrime traces Toolset Document students September 2013 Page ii About ENISA The European Union Agency Network Information Security ENISA centre network information security expertise EU Member States private sector Europe™s citizens ENISA works groups develop advice recommendations good practice information security It assists EU Member States implementing relevant EU legislation works improve resilience Europe™s critical information infrastructure networ ks ENISA seeks enhance existing expertise EU Member States supporting development cross -border communities committed improving network information security throughout EU More information ENISA work found www.enisa.europa.eu Authors This document created CERT capability team ENISA consultation Don Stikvoort Michael Potter Alan Thomas Robinson S-CURE The Netherlands Maj Tomasz Chlebowski ComCERT Poland Roeland Reijers Rubicon Projects T Netherlands -CERT Services Germany Contact CERT -Relations @ enisa.europa.eu ies document please use press @ enisa.europa.eu Acknowledgements ENISA wants thank institutions nd persons contributed document A special ‚Thank You ™ goes following contributors Robin Ruefle CERT Coordination Center United States Toomas Lepik CERT -EE Estonia Thomas Lima CERT.PT Portugal Krystian Kochanowski Adam Ziaja ComCERT SA Poland Vincent Danjen Interpol Andrew Cormack JANET United Kingdom Katrina Sataki NIC.LV Latvia Anna - Police Academy Poland Jim Buddin TERENA The Nethe rlands Identifying handling cybercrime traces Toolset Document students September 2013 Page iii Legal notice Notice must taken publication represents views interpretations authors editors unless stated otherwise This publication construed legal action ENISA ENISA bodies unless adopted pursuant Regulation EU No 526/2013 This publication necessarily represent state -of -art ENISA may update time time Third - sources inc luding external websites referenced publication This publication intended information purposes It must accessible free charge Neither ENISA person acting behalf responsible use might made information contained publication Copyright Notice © European Union Agency Network Information Security ENISA 2013 Reproduction authorised provided source acknowledged ISBN 978-92-79-00077-5 doi:10.2788/14231 Identifying handling cybercrime traces Toolset Document students September 2013 Page iv Table Contents 1 General Description 1 2 Introduction 3 3 Task 1 Œ Social Media based Twitter example 4 3.1 Subtask 1 Œ Twitter accounts ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 4 3.2 Subtask 2 Œ Keywords ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 4 3.3 Subtask 3 Œ Code development ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... .. 5 3.4 Conclusion Task 1 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 8 4 Task 2 Œ IRC channels 9 5 Task 3 Œ Multiple online sources finding relevant information 12 5.1 Sub -task 1 Œ Find information related ENISA Twitter published last week ... 12 5.2 Sub -task 2 Œ Find social media services contain information specific user recognised nickname ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 13 5.3 Sub -task 3 Œ Finding phone numbers people using PGP software particular organisation ... 13 6 Task 4 Œ Legal aspects Internet monitoring services 18 7 Appendix 1 Œ The code example 1 network monitoring Twitter 19 8 Appendix 2 Œ The code example visual presentation tweets searching 25 9 Appendix 3 Œ The code example IRC monitoring 27 10 References 29 Identifying handling cybercrime traces Toolset Document students September 2013 Page 1 1 General Description This exercise consists three components The f irst two components tasks collecting possible incident -related information specia l focus information specific various sources like social media IRC channels Very often information IP -based information regular source relevant information CERTs More relevan information content -specific Thus working cons tituency better understanding technical envir CERT provides services particular organisation owner ‚ABC123 ™ system CERT needs start ac tive network monitoring information related system There already many instances successful use social media tracking criminals These include Two men identified criminals attacked DDoS attack Amazon EBay Priceline They bragging fact online hackers™ forum They acti forum shared lot information various attacks stolen credit cards .1 Hackers discussed break -in activity Sony PlayStation Network fact credit card numbers possession underground Internet forum Figure 1 Hacker forum screenshot presenting discussion type data hackers tole Sony 2 In f irst two subtasks Task 1 Twitter accounts keywords learn rules content -related network monitoring use knowledge Task 2 except Task 2 talking Twitter accounts IRC channels The following tools also used exercises Task 3 1 More http //arstechnica.com/security/2012/07/hacking -duo -charged -for -amazon -ddos/ 2 Source New York Times online service http //bits.blogs.nytimes.com/2011/04/28/hackers -claim -to-have -playstation -users -card -data/ ? _r=0 Identifying handling cybercrime traces Toolset Document students September 2013 Page 2 Topsy.com service NameChk.com service Maltego http //www.paterva.com/web6/products/maltego.php performing Task 4 Œ Legal aspects Internet monitoring services learn legal aspects Internet monitoring activities It obvious trainees come different countries different legal systems general r ules relate topic learnt The e xample presented exercise base upon national legislation important aspect relates Personal Data Protection Law 3 3 The Personal Data Protection Law EU Member States based directive Œ 2002/58/EC European Parliament Council 12 July 2002 concerning processing personal data protection privacy electronic co mmunications sector Directive privacy electronic communications Its content official EU languages available http //eur -lex.europa.eu/LexUriS erv/LexUriServ.do ? uri=CELEX:32002L0058 EN NOT Identifying handling cybercrime traces Toolset Document students September 2013 Page 3 2 Introduction At beg inning exercise trainer inform fo llowing key factors The CERT responsible specific constituency part CERT services network monitoring active detection .4 Your area interest various information sources detect potential incident technical point view also point view identifying attackers You also take consideration al l legal aspects related performance work according existing law country Special attention paid activities related regular collection usage data could treated personal data Important issues confi dentiality communication tech nical protection stored data collection sensitive data data anonymis ation attribution handing assumptions made It also important use publicly available system content monitoring kept minimum The main reas avoid discovery monitoring activity potential cybercriminal s. The main schema tasks related identifying cybercrime traces Figure 2 The general model performing exercise tasks 5 There two main sources information discussed analysed exercises Social media based Twitter example Internet chat forums Additionally methods col lecting information Internet using services available online installing computer 4 Classic IP threats monitoring main task exercise 5 Abbreviations used figure NM Œ network monitoring IH Œ Incident Handling discuss NM IH capabilities develop algorithm NM IH use write appropriate code test code real environment Identifying handling cybercrime traces Toolset Document students September 2013 Page 4 3 Task 1 Œ Social Media based Twitter example The possibility social media monitoring analysed using example Twitter seems attractive source potent ially relevant information ssigned e groups 3.1 Subtask 1 Œ Twitter accounts The first subtask dis cuss determine Twitter user accounts opinion could become significant sources relevant information You use favourite Twitter accounts well carrying Internet research exercise collect new favourites The guidance selection main area interest sh ould Twitter users ' channels words could helpful finding relevant channels e.g ‚anon ™ ‚tango ™ ‚ops ™ ‚corrupt ™ ‚Cr3w ™ ‚cyberwars ™6 ge ographical location matter e.g ‚AnonInPol ™ user chan nel periodic actions/operations bring rele vant information e.g ‚ # OpUSA ™ focus channels related particular groups Some information channels specialise monitoring groups good intermediates At end task group present proposals Twitter accounts Prepare short presentation form list keywords Also suggest hackers™ slang terms use investigations 3.2 Subtask 2 Œ Keywords This subta sk develop list keywords used monitoring detecti In practice services provided two sources keywords set provided constituency representative This ty pe usually organisa tion -oriented often refers specific systems organisations ™ representatives like system names particular persons ™ names etc On one hand helpful system owners best sources relevant information hand keywords im practical terms existence underground sources information language used criminals set developed CERT members This set usually practical terms keywords ™ existence unde rground It natural addendum set provided constituency representative Good examples keywords ‚ENISA ™ ‚European Union Agency Netw ork Information Security ™ English name local name e.g translation English local language like ‚agency ™ ‚agencja ™ Polish even focus IP addresses good set treated text string domain name monitored organisation part constituency e.g ‚enisa.europa.eu ™ ‚europa.eu ™ 6 Sample terms Identifying handling cybercrime traces Toolset Document students September 2013 Page 5 words usually used information successful attack issued e.g ‚tango ™ ‚p0wned ™ ‚hacked ™ If local language wo rds also often used situation added set Now present proposals keywords This short presentation form simple list Think Œ presented others 3.3 Subtask 3 Œ Code development The next third subtask develop code monitoring script The main task code monitor chosen users ' channels alert whenever condition monitoring met The modules f script could following Figure 3 Modules Twitter monitoring code use common set examples The script found Virtual Machine /home/ enisa /enisa /monitoring/ A screenshots script result processing presented definition keywords set Twitter accounts monitoring collection tweets matching tweets keywords alerting investigators Identifying handling cybercrime traces Toolset Document students September 2013 Page 6 Figure 4 Screenshot script Twi tter monitoring Figure 5 Screenshot script Twitter mo nitoring ID numbers tweets The co de example functional description given Appendix 2 Œ The code example 1 network monitoring Twitter In example keyword ‚hacked ™ monitored Twitter account ‚AnonOpsLegion ™ Identifying handling cybercrime traces Toolset Document students September 2013 Page 7 2013-07-03 20:05:18 https //twitter.com/AnonOpsLegion/status/35248823441411276 9 Muslim Brotherhood spokesman says social media feeds hacked # Egypt http //t.co/9b9fEe8MUv results another script used see Appendix 3 Œ The code example visual presentation tweets searching The graphical output script execution ‚ENISA ™ keyword Figure 6 The gr aphical representation ‚ENISA ™ keywor Identifying handling cybercrime traces Toolset Document students September 2013 Page 8 Figure 7 Screenshot script graphical representatio n Twitter search results 3.4 Conclusion T ask 1 After task completed trainer lead wrap -up session During session discuss Effectiveness search Twitter channel Legal considerations related kind search Your experiences ideas effective monitoring social media The interesting keywords including hackers™ sl ang words effective search Examples graphical representation Twitter monitoring solution work ed Identifying handling cybercrime traces Toolset Document students September 2013 Page 9 4 Task 2 Œ IRC channels During task improve skills moni toring IRC channels Automating k ind work probably one difficult tasks security professionals The first subtask analyse security aspects IRC channels monitoring The dangerous aspect possibility identification person organisation carrying monitoring identification fact presence channel monitoring discovering criminal activity Such identification provoke attacks investigating party You develop ideas challenge problems The main ideas use anonymi sation network connectivity e.g TOR service The IRC channel reached anonymously executing ‚torify ™ command part ‚tor ™ package Ubuntu Debian distributions If want example use irssi client following command executed torify irssi periodically make ‚human action ™ channel order recognised trusted party periodi cally share potentially valuable information criminal ™s perspective This information bring real value example could -published public sources The second subtask develop script aler investigators relevant IRC conversation The assumption investigators secure IRC channel functionality place reduce possibility detection identification The ir main goal develop solution search IRC content logs match keywords finally alert investigators via email message Regarding keywords rules setting exactly related social media channels The cript found Virtual Machine /home/ enisa /enisa /monitoring/ A screenshots script result processing presented Identifying handling cybercrime traces Toolset Document students September 2013 Page 10 Figure 8 Screenshot script IRC monitoring Script code Figure 9 Screenshot IRC client IRSSI IRC monitoring Identifying handling cybercrime traces Toolset Document students September 2013 Page 11 Figure 10 Screenshot result IRC monitoring Identifying handling cybercrime traces Toolset Document students September 2013 Page 12 5 Task 3 Œ Multiple online sources finding relevant information This task work various online services used CERT staff process finding relevant information particular cases constant monitoring constituency During task also work groups At beginning please work 20 minutes list services three categories Category A Œ services use regularly CERT work Categ ory B Œ services use regularly CERT work know would helpful particular sit uation worth consider ing regular service future Category C Œ services understood functionality could helpful CERT staff 5.1 Sub -task 1 Œ Find information related ENISA Twitter published la st week task use topsy.com service You put ‚ENISA ™ keyword search window choose specific time range Figure 11 The result ‚ENISA ™ search topsy .com service Identifying handling cybercrime traces Toolset Document students September 2013 Page 13 As see uch general search come lot irrelevant information Thus please tune search excluding false negative results much possible e.g include words like ‚love ™ ‚girls ™ ‚Bukvic ™ ‚Custovic ™ operator 5.2 Sub -task 2 Œ Find social media services contain information specific user recognised nickname purpose partici pant ca n use NameChk.com service Figure 12 The result ‚ENISA ™ search namechk.com service Your additional task provide list accounts could use monitoring 5.3 Sub -task 3 Œ Finding phone numbers people using PGP software particular organisation If want investigate particular organisation probably collect many pieces information One could phone numbers PGP keys used th e organisation The tool used purpose Maltego Maltego open source intelligence forensics application It offers mining gathering information well representation Identifying handling cybercrime traces Toolset Document students September 2013 Page 14 information n easy -to-understand format It available free tool non -commercial purposes You c download tool Pa terva website http //www.paterva.com /web6/products/download.php After installation software interface shows available functionality Figure 13 Screenshot Maltego application 5.3.1 Finding PGP keys In sub -task organisation investigated ENISA To select organisation need choose domain This done dragging dropping domain palette left side bar Identifying handling cybercrime traces Toolset Document students September 2013 Page 15 Figure 1 4 Choosing org ani sation website selection Having icon main board double clicking name organisation changed enisa.europa.eu Then task receive information particular PGP keys available organisation Please find appropriate function service get Your result shou ld imilar presented figure Identifying handling cybercrime traces Toolset Document students September 2013 Page 16 Figure 1 5 Screenshot 1 Œ Information PGP key available organisation 5.3.2 Finding phone numbers Your next task similar shoul add information available phone If successful result similar presented Identifying handling cybercrime traces Toolset Document students September 2013 Page 17 Figure 16 Screenshot 2 Œ Information organisation phone numbers property view one numbers The sub -tasks Task 3 showed examples possible tracking activities Maybe know known sources valuable information ? Always remember permitted use legal methods information collection The Maltego Tool powerful tool small part capabilities presented exercise Now experiment tool find possible ways use To learn functionalites watch video tutorials prepared Paterva They available http //www.paterva.com/web6/documentation/index.php Identifying handling cybercrime traces Toolset Document students September 2013 Page 18 6 Task 4 Œ Legal aspects Internet monitoring services In part exercise task develop kind internal legal guide investigation work team Consider potential risks particular Think - establishing relations law enforcement agencies - legal power real n eeds - protection collected information - protection personal data part monitoring could made public result Now analyse laws country The result analysis matrix name country rows law ru les columns Œ see example .7 Country/Law Personal Data Protection Classified Information Protection Data Breach Notification etc Poland Personal data processed - approval data subject - necessary fulfil legal - necessary public benefit - necessary fulfi lling legitimate tasks violate data subject rights If processed information classified must - rev ealed authoris ed person - processed protected environment technically physically - protected acc ording specif ied rules described special documents define protection level ISP must report data subject personal data breach network later 3 days discovery ISP must report National Data Authority personal data breach network later 3 days discovering Greece The Netherlands Germany – ready present findings discuss others Pay special attention protection personal data 7 The proposals table examples law Identifying handling cybercrime traces Toolset Document students September 2013 Page 19 7 Appendix 1 Œ The code example 1 network monitoring Twitter To use script Twitter account register application https //dev.twitter.com/apps/new To register application use Twitter account Figure 17 Screenshot presenting template creating app lication Twitter website Identifying handling cybercrime traces Toolset Document students September 2013 Page 20 Figure 18 Screenshot presenting information bout regi stered organisation Figure 19 Screenshot presenting information ssued token application Identifying handling cybercrime traces Toolset Document students September 2013 Page 21 // number last checked statuses $ notweets = 10 session_start // https //github.com/abraham/twitteroauth // Twitter API $ oauth_token_secret { $ connection = new TwitterOAuth $ cons_key $ cons_secret $ oauth_token $ oauth_token_secret return $ connection } $ accesstokensecret $ alertarray = array // interesting user foreach $ twitterusers $ twitteruser { $ tweets = $ connection - > // error handler Twitter API $ err = NULL foreach $ tweets - > errors $ error { echo $ error - > message $ err = true } // stop error $ err { \r\n\r\nStop errors \r\ } // tweet interesting user Identifying handling cybercrime traces Toolset Document students September 2013 Page 22 foreach $ tweets $ tweet { // parse time format $ tweetdate = date ' Y -m-d H ' strtotime $ tweet - > created_at $ tweetid = $ tweet - > id_str // create URL data - > user - > $ tweettext = $ tweet - > text // checking tweet retweet substr $ tweettext 0 4 == 'RT @ ' { $ tweetid = $ tweet - > id_str // tweet retweet add .= U RL $ tweeturl var \r\ - > retweeted_status - > user - > screen_name $ tweettext = $ tweet - > retweeted_status - > text } // check whether status database try { // SQLite // database create $ db - ISTS underground_twitter id INTEGER PRIMARY KEY id_str foreach $ db - - $ tweetid \r\ } } catch PDOException $ e { print 'Exception ' $ e - > getMessage } // SELECT database return 0 record n't exist database $ count == 0 { // INSERT INTO database tweet id Identifying handling cybercrime traces Toolset Document students September 2013 Page 23 < ? php - social media Twitter // interesting keywords Then Twitter 's users pointed // interesting users The next step us e publicly available Twitter API The trainer inform trainees availability API https //github.com/abraham/twitteroauth This helps build databases IDs tweets iscovered threat // interesting keyword foreach $ warningstrings $ warningstring { // check url foreach $ tweet - > entities - > urls $ turl { strpos $ turl - > expanded_url $ warningstring ! == false { $ alert = $ tweetdate $ separator $ tweeturl $ separator $ tweettext $ separator // add alert array array_push $ alertarray $ alert } } // check tweet strpos $ tweettext $ warningstring ! == false { try { $ db - > } catch PDOException $ e { print 'Exception ' $ e - > getMessage } Identifying handling cybercrime traces Toolset Document students September 2013 Page 24 $ alert = $ tweetdate $ separator $ tweeturl $ separator $ tweettext $ separator // add alert array array_push $ alertarray $ alert } } } } } \r\ $ alertstrlen = strlen $ alertnotify \r\ \r\ } $ alertstrlencheck = strlen $ alertnotify // least one new tweet $ alertstrlen < $ alertstrlencheck { echo $ alertnotify // send e -mail mail 'alert @ -cert.eu ' ' Identifying cybercrime traces Twitter ' $ alertnotify } ? > Identifying handling cybercrime traces Toolset Document students September 2013 Page 25 8 Appendix 2 Œ The code example visual presentation tweets searching < html > < head > google.setOnLoadCallback drawChart function drawChart { var data = google.visualization.arrayToDataTable < ? php // https //github.com/abraham/twitteroauth // Twitter API $ con $ oauth_token_secret { $ connection = new TwitterOAuth $ cons_key $ cons_sec ret $ oauth_token $ oauth_token_secret return $ connection } cesstoken $ accesstokensecret // https //dev.twitter.com/docs/api/1.1/get/search/tweets // https //dev.twitter.com/docs/using -search $ tweets = $ connection - $ stack = array foreach $ tweets - > statuses $ tweet { //var_dump $ tweet $ tweetdate = date ' Y -m-d H ' strtotime $ tweet - > created_at $ tweettext = $ tweet - > text Identifying handling cybercrime traces Toolset Document students September 2013 Page 26 \ array_push $ stack explode ' ' $ tweetdate 0 } $ stac k = array_count_values $ stack \t\t\t\t\t 'Day ' ' # ENISA ' \ $ pie = current $ stack { \t\t\t\t\ \ next $ stack } $ chart = substr $ chart 0 -2 echo $ chart ? > var options = { title ' # ENISA last 100 weets' } var chart = new google.visualization.ColumnChart document.getElementById 'chart_div ' chart.draw data options } < /script > < /head > < body > < /body > < /html > Identifying handling cybercrime traces Toolset Document students September 2013 Page 27 9 Appendix 3 Œ The code example IRC monitoring # ! /bin/bash # Identifying cybercrime traces - IRC channel # script run every midnight # irssi IRC client settings # /se -- # /set autolog # search interesting keywords logs yesterday # domain.xx domain name server -name $ date -- - - -exec egrep -il \ ' N $ ! ba s/ \n/ - - IRCLEN= ` echo $ { # IRC } ` If keyword found invest igators notified via email # file $ IRCLEN -gt 0 # send e -mail log - -cert.eu $ IRC The result script mail contains matched word In example due content monitoring channel ﬁhackchatﬂ keyword ﬁorg_one.gov.euﬂ discovered conversation criminals Logs -- - Log opened Sun Jun 29 00:00:13 2013 00:04 - ! - hacker0 1_ hacker01^anonmx @ AN -di2.t5r4.govi.IP joined # hackchat 00:04 - ! - 00:07 - ! - hacker01__ hacker01^anonmx @ AN -di2.t5r4.govi.IP joined # hackchat 00:07 - ! - hacker01_ hacker01^anonmx @ AN -di2.t5r4.govi Connection closed 00:07 - ! - 00:08 - ! - hacker01 hacker01^anonmx @ AN - 00:09 - ! - hacker01__ hacker01^anonmx @ AN - Connection closed 00:09 - ! - Odik__ Ella__ @ AN -20e.6tt.42adcl.IP joined # hackchat 00:09 - ! - 00:09 - ! - Dragon Dragon @ AN - closed 00:09 - ! - Connection closed Identifying handling cybercrime traces Toolset Document students September 2013 Page 28 00:09 - ! - wawka @ yourhouse.anymore joined # hackchat 00:09 - ! - 00:09 - ! - Dragon_ Dragon @ AN -j3b.im0.23nk0v.IP joined # hackchat 00:09 - ! - 00:10 - ! - hacker01 hacke r01^anonmx @ AN -di2.t5r4.govi.IP joined # hackchat 00:10 - ! - 00:12 - ! - Ella_ Ella__ @ AN - 121 seconds 00:17 - ! - hacker01 hacker01^anonmx @ AN -di2.t5r4.govi.IP Connection closed 00:18 - ! - hacker01 hacker01^anonmx @ AN -di2.t5r4.govi.IP joined # hackchat 00:18 - ! - 00:20 - ! - 00:20 - ! - Dragon Dragon @ AN -j3b.im0.23nk0v.IP j oined # hackchat 00:20 < Dragon > hi let 's hack org_one.gov.eu 00:20 - ! - Ella_ Ella__ @ AN -20e.6tt.42adcl.IP joined # hackchat 00:20 - ! - 00:21 < hacker01 > ok let 's 01:21 - ! - Dragon_ Dragon @ AN - uit Ping timeout 121 seconds 01:22 - ! - hacker01 hacker01^anonmx @ AN - Connection closed 01:22 - ! - -- - Log closed Jun 29 01:22:25 2013 Identifying handling cybercrime traces Toolset Document students September 2013 Page 29 10 References 1 ‚Hacking duo charged DDoSing Amazon bragging it™ http //arstechnica.com/security/2012/07/hacking -duo-charged -for -amazon -ddos/ 2 ‚Hackers Claim Have PlayStation Users™ Card Data ™ http //bits.blogs.nytimes.com/2011/04/28/hackers -claim -to-have -playstation -users -card -data/ ? _r=0 3 The Pe rsonal Data Protection Law EU Member States based directive Œ2002/58/EC European Parliament Council 12 July 2002 concerning processing personal data protection privacy electronic communicatio ns sector Directive privacy electronic communications Its content official EU languages available http //eur -lex.europa.eu/LexUriServ/LexUr iServ.do ? uri=CELEX:32002L0058 EN NOT Identifying handling cybercrime traces Toolset Document students September 2013 Page 30 ENISA European Union Agency Network Information Security Science Technology Park Crete ITE Vassilika Vouton 700 13 Heraklion Greece Athens Office Marousi 151 24 Athens Greece PO Box 1309 710 01 Heraklion Greece Tel +30 28 14 40 9710 info @ enisa.europa.eu www.enisa.europa.eu 